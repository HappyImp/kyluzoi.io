<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Jetpack 开发笔记 | Hi Kyluzoier</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/kyluzoi.io/favicon.ico">
    <meta name="description" content="欢迎来到我的 Blog">
    
    <link rel="preload" href="/kyluzoi.io/assets/css/0.styles.cc501f3d.css" as="style"><link rel="preload" href="/kyluzoi.io/assets/js/app.8eb898c6.js" as="script"><link rel="preload" href="/kyluzoi.io/assets/js/2.6dcf33ab.js" as="script"><link rel="preload" href="/kyluzoi.io/assets/js/3.d552ed0b.js" as="script"><link rel="prefetch" href="/kyluzoi.io/assets/js/10.fbb57a96.js"><link rel="prefetch" href="/kyluzoi.io/assets/js/11.2d7c1339.js"><link rel="prefetch" href="/kyluzoi.io/assets/js/12.3d15b72d.js"><link rel="prefetch" href="/kyluzoi.io/assets/js/13.f2450106.js"><link rel="prefetch" href="/kyluzoi.io/assets/js/14.b568a106.js"><link rel="prefetch" href="/kyluzoi.io/assets/js/15.357b2359.js"><link rel="prefetch" href="/kyluzoi.io/assets/js/16.862a1451.js"><link rel="prefetch" href="/kyluzoi.io/assets/js/4.cf5610b2.js"><link rel="prefetch" href="/kyluzoi.io/assets/js/5.54f1a9d7.js"><link rel="prefetch" href="/kyluzoi.io/assets/js/6.78d4d1af.js"><link rel="prefetch" href="/kyluzoi.io/assets/js/7.8a4cc7fc.js"><link rel="prefetch" href="/kyluzoi.io/assets/js/8.ff1348c4.js"><link rel="prefetch" href="/kyluzoi.io/assets/js/9.cb415c9f.js">
    <link rel="stylesheet" href="/kyluzoi.io/assets/css/0.styles.cc501f3d.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/kyluzoi.io/" class="home-link router-link-active"><!----> <span class="site-name">Hi Kyluzoier</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/kyluzoi.io/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/kyluzoi.io/Note/Java/" class="nav-link">
  Java
</a></div><div class="nav-item"><a href="/kyluzoi.io/Note/Android/" class="nav-link router-link-active">
  Android
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/kyluzoi.io/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/kyluzoi.io/Note/Java/" class="nav-link">
  Java
</a></div><div class="nav-item"><a href="/kyluzoi.io/Note/Android/" class="nav-link router-link-active">
  Android
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Java 学习</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Android 学习</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/kyluzoi.io/Note/Android/Jetpack开发笔记.html" class="active sidebar-link">Jetpack 开发笔记</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/kyluzoi.io/Note/Android/Jetpack开发笔记.html#navigation" class="sidebar-link">Navigation</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/kyluzoi.io/Note/Android/Jetpack开发笔记.html#_1-navigationcontroller-handledeeplink" class="sidebar-link">1.NavigationController#handleDeepLink</a></li><li class="sidebar-sub-header"><a href="/kyluzoi.io/Note/Android/Jetpack开发笔记.html#_2-navigation各类之间的关系" class="sidebar-link">2.Navigation各类之间的关系</a></li><li class="sidebar-sub-header"><a href="/kyluzoi.io/Note/Android/Jetpack开发笔记.html#_3-navprocessor-destination注解处理器" class="sidebar-link">3.NavProcessor  destination注解处理器</a></li></ul></li><li class="sidebar-sub-header"><a href="/kyluzoi.io/Note/Android/Jetpack开发笔记.html#网络库的封装" class="sidebar-link">网络库的封装</a></li><li class="sidebar-sub-header"><a href="/kyluzoi.io/Note/Android/Jetpack开发笔记.html#分页组件" class="sidebar-link">分页组件</a></li><li class="sidebar-sub-header"><a href="/kyluzoi.io/Note/Android/Jetpack开发笔记.html#livedata" class="sidebar-link">LiveData</a></li><li class="sidebar-sub-header"><a href="/kyluzoi.io/Note/Android/Jetpack开发笔记.html#qq快捷登录" class="sidebar-link">QQ快捷登录</a></li><li class="sidebar-sub-header"><a href="/kyluzoi.io/Note/Android/Jetpack开发笔记.html#fitsystemwindow" class="sidebar-link">fitSystemWindow</a></li><li class="sidebar-sub-header"><a href="/kyluzoi.io/Note/Android/Jetpack开发笔记.html#day5" class="sidebar-link">Day5</a></li><li class="sidebar-sub-header"><a href="/kyluzoi.io/Note/Android/Jetpack开发笔记.html#day6" class="sidebar-link">Day6</a></li><li class="sidebar-sub-header"><a href="/kyluzoi.io/Note/Android/Jetpack开发笔记.html#day-7" class="sidebar-link">Day 7</a></li><li class="sidebar-sub-header"><a href="/kyluzoi.io/Note/Android/Jetpack开发笔记.html#day-8" class="sidebar-link">Day 8</a></li><li class="sidebar-sub-header"><a href="/kyluzoi.io/Note/Android/Jetpack开发笔记.html#day-9" class="sidebar-link">Day 9</a></li></ul></li><li><a href="/kyluzoi.io/Note/Android/test02.html" class="sidebar-link">test02</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="jetpack-开发笔记"><a href="#jetpack-开发笔记" class="header-anchor">#</a> Jetpack 开发笔记</h1> <h2 id="navigation"><a href="#navigation" class="header-anchor">#</a> Navigation</h2> <h3 id="_1-navigationcontroller-handledeeplink"><a href="#_1-navigationcontroller-handledeeplink" class="header-anchor">#</a> 1.NavigationController#handleDeepLink</h3> <p><img src="/kyluzoi.io/assets/img/handleDeepLink.f6ca247d.png" alt="image-20190923145249042"></p> <p>如果外部应用打开客户端并携带了uri: ppjoke://page/pageD ,那么 A、B、C、D都会被打开</p> <h3 id="_2-navigation各类之间的关系"><a href="#_2-navigation各类之间的关系" class="header-anchor">#</a> 2.Navigation各类之间的关系</h3> <p><img src="/kyluzoi.io/assets/img/navigation.d23330df.png" alt="image-20190922210037213"></p> <h3 id="_3-navprocessor-destination注解处理器"><a href="#_3-navprocessor-destination注解处理器" class="header-anchor">#</a> 3.NavProcessor  destination注解处理器</h3> <ul><li><p>需要把工程的gradle-wrapper和gradle-plugin分别降低到4.10.1，3.2.0。<a href="https://github.com/gradle/gradle/issues/1471" target="_blank" rel="noopener noreferrer">详细原因<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p>如果不想降级gradle，那么必须在<code>libnavcompiler</code>中额外添加依赖</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>annotationProcessor <span class="token string">'com.google.auto.service:auto-service:1.0-rc6'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li></ul> <div class="language-java line-numbers-mode"><pre class="language-java"><code>implementation <span class="token function">project</span><span class="token punctuation">(</span><span class="token string">':libnavannotation'</span><span class="token punctuation">)</span>

implementation <span class="token string">'com.alibaba:fastjson:1.2.59'</span>

api <span class="token string">'com.google.auto.service:auto-service:1.0-rc6'</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h2 id="网络库的封装"><a href="#网络库的封装" class="header-anchor">#</a> 网络库的封装</h2> <ul><li><p>网络库的封装</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code> implementation <span class="token string">'com.squareup.okhttp3:okhttp:4.2.0'</span>
 implementation <span class="token string">'com.squareup.okhttp3:logging-interceptor:3.5.0'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li> <li><p>Room数据库缓存</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>implementation <span class="token string">'android.arch.persistence.room:runtime:1.1.1'</span>
    implementation <span class="token string">&quot;android.arch.lifecycle:extensions:1.1.1&quot;</span>
    annotationProcessor <span class="token string">'android.arch.persistence.room:compiler:1.1.1'</span>
    annotationProcessor <span class="token string">&quot;android.arch.lifecycle:compiler:1.1.1&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li> <li><p>泛型类型获取</p> <ul><li><p><a href="https://blog.csdn.net/harvic880925/article/details/50085595" target="_blank" rel="noopener noreferrer">参考文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p>从Java 5开始class文件的格式有了调整，规定这些泛型信息要写到java文件中，没有显示明确声明泛型类型的，会被编译器在编译时擦除掉。比如<code>new ArrayList&lt;User&gt;</code>传递的泛型类型会被擦除。</p></li> <li><p>但是<code>new Interface</code>出传递的泛型类型运行时是能获取到的，因为编译时会生成<code>Interface</code>的匿名内部类，内部类已经显示明确生命了泛型的类型。不会被擦除</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">InnerClass</span> <span class="token keyword">implements</span> <span class="token class-name">Interface</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span>
 <span class="token class-name">ParameterizedType</span> type <span class="token operator">=</span>    <span class="token punctuation">(</span><span class="token class-name">ParameterizedType</span><span class="token punctuation">)</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getGenericSuperclass</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
 <span class="token class-name">Type</span> actual <span class="token operator">=</span> type<span class="token punctuation">.</span><span class="token function">getActualTypeArguments</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
 <span class="token comment">//actual就是List&lt;User&gt;类型的</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li></ul></li> <li><p>Response数据结构体</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;status&quot;</span><span class="token operator">:</span><span class="token number">200</span><span class="token punctuation">,</span>
    <span class="token property">&quot;message&quot;</span><span class="token operator">:</span><span class="token string">&quot;成功&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;data&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token property">&quot;data&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
       <span class="token comment">// &quot;data&quot;:[],</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div></li></ul> <h2 id="分页组件"><a href="#分页组件" class="header-anchor">#</a> 分页组件</h2> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">//刷新分页组件</span>
api <span class="token string">'com.scwang.smartrefresh:SmartRefreshLayout:1.1.0'</span>
api <span class="token string">'com.scwang.smartrefresh:SmartRefreshHeader:1.1.0'</span>

<span class="token comment">//exo播放器</span>
api <span class="token string">'com.google.android.exoplayer:exoplayer-core:2.10.4'</span>
api <span class="token string">'com.google.android.exoplayer:exoplayer-dash:2.10.4'</span>
api <span class="token string">'com.google.android.exoplayer:exoplayer-ui:2.10.4'</span> 

<span class="token comment">//viewmodel and livedata</span>
api <span class="token string">'androidx.lifecycle:lifecycle-extensions:2.1.0'</span>

<span class="token comment">//或者指明仅仅使用 livedata、viewmodel</span>
api <span class="token string">&quot;androidx.lifecycle:lifecycle-viewmodel:2.1.0&quot;</span>
api <span class="token string">'androidx.lifecycle:lifecycle-livedata:2.1.0'</span>      

<span class="token comment">//paging分页组件</span>
api <span class="token string">'androidx.paging:paging-runtime:2.1.0'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h5 id="_1-pagedlist只支持查询-get-不支持增删改-如何实现呢"><a href="#_1-pagedlist只支持查询-get-不支持增删改-如何实现呢" class="header-anchor">#</a> 1.PagedList只支持查询(get)，不支持增删改，如何实现呢？</h5> <h5 id="_2-paging如何做到上拉分页时手动触发数据请求并更新页面"><a href="#_2-paging如何做到上拉分页时手动触发数据请求并更新页面" class="header-anchor">#</a> 2.paging如何做到上拉分页时手动触发数据请求并更新页面？</h5> <h5 id="_3-diffutil原理之myers-差分算法"><a href="#_3-diffutil原理之myers-差分算法" class="header-anchor">#</a> 3.DiffUtil原理之<a href="https://www.jianshu.com/p/aac191f0b1ee" target="_blank" rel="noopener noreferrer">Myers 差分算法<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></h5> <h2 id="livedata"><a href="#livedata" class="header-anchor">#</a> LiveData</h2> <h5 id="livedata时序图"><a href="#livedata时序图" class="header-anchor">#</a> LiveData时序图</h5> <p><img src="/kyluzoi.io/assets/img/livedata.bd2ac6c0.png" alt="livedata"></p> <h5 id="paging执行刷新流程"><a href="#paging执行刷新流程" class="header-anchor">#</a> paging执行刷新流程</h5> <p><img src="/kyluzoi.io/assets/img/paging-refresh.852c2bd7.png" alt="pageing刷新"></p> <h2 id="qq快捷登录"><a href="#qq快捷登录" class="header-anchor">#</a> QQ快捷登录</h2> <p><a href="https://connect.qq.com/?id=1" target="_blank" rel="noopener noreferrer">QQ互联<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>平台申请注册应用，AppId:101794421,AppKey:54689cdfd321c4fbe47fbd39dcdccad6</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>implementation <span class="token function">files</span><span class="token punctuation">(</span><span class="token string">'libs/open_sdk_r6140_lite.jar'</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 注册<span class="token class-name">SDKActivity</span> <span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>activity
           android<span class="token operator">:</span>name<span class="token operator">=</span><span class="token string">&quot;com.tencent.tauth.AuthActivity&quot;</span>
           android<span class="token operator">:</span>launchMode<span class="token operator">=</span><span class="token string">&quot;singleTask&quot;</span>
           android<span class="token operator">:</span>noHistory<span class="token operator">=</span><span class="token string">&quot;true&quot;</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>intent<span class="token operator">-</span>filter<span class="token operator">&gt;</span>
              <span class="token operator">&lt;</span>action android<span class="token operator">:</span>name<span class="token operator">=</span><span class="token string">&quot;android.intent.action.VIEW&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
              <span class="token operator">&lt;</span>category android<span class="token operator">:</span>name<span class="token operator">=</span><span class="token string">&quot;android.intent.category.DEFAULT&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
              <span class="token operator">&lt;</span>category android<span class="token operator">:</span>name<span class="token operator">=</span><span class="token string">&quot;android.intent.category.BROWSABLE&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
              <span class="token operator">&lt;</span>data android<span class="token operator">:</span>scheme<span class="token operator">=</span><span class="token string">&quot;tencent101794421&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>intent<span class="token operator">-</span>filter<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>activity<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>activity        android<span class="token operator">:</span>name<span class="token operator">=</span><span class="token string">&quot;com.tencent.connect.common.AssistActivity&quot;</span>
android<span class="token operator">:</span>screenOrientation<span class="token operator">=</span><span class="token string">&quot;portrait&quot;</span>              android<span class="token operator">:</span>theme<span class="token operator">=</span><span class="token string">&quot;@android:style/Theme.Translucent.NoTitleBar&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p><a href="https://wiki.connect.qq.com/%E7%99%BB%E5%BD%95-%E6%A0%A1%E9%AA%8C%E7%99%BB%E5%BD%95%E6%80%81" target="_blank" rel="noopener noreferrer">拉起登录<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://wiki.connect.qq.com/get_user_info" target="_blank" rel="noopener noreferrer">获取QQ登录的用户信息<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="fitsystemwindow"><a href="#fitsystemwindow" class="header-anchor">#</a> fitSystemWindow</h2> <p>他会请求window重新分发状态栏所在的矩形范围，以使得我们的沉浸式状态栏的布局也能够在状态之下显示。但是。如果是一个Activity嵌套的多个Fragment页面的。由于ViewGroup#dispatchApplyWindowInsets方法的约束，只有ViewGroup的第一个直接子View能够接受的到自适应状态栏的事件，其他的子View都无法接收到这个事件</p> <h2 id="day5"><a href="#day5" class="header-anchor">#</a> Day5</h2> <ul><li><p>父类ViewHandler 实现评论列表、底部互动区域数据请求和绑定，行为事件处理，添加一条评论，空布局等功能</p></li> <li><p>ImageViewHandler实现头部、标题栏和评论列表的滑动联动效果</p></li> <li><p>如何实现给PagedList添加一条item？通过创建<code>MutableItemKeyedDataSource</code>然后把新的数据和列表上之前的数据都拼接到``MutableItemKeyedDataSource<code>中，在通过</code>listAdapter#submitList`paging框架会拿当前提交的数据集合 和 之前展示的数据做差分异，只会在指定的位置上 移动&amp;删除&amp;更新。所以不用担心这种方式 会卡顿什么的</p></li></ul> <h2 id="day6"><a href="#day6" class="header-anchor">#</a> Day6</h2> <ul><li>CameraX视频预览：</li></ul> <div class="language-java line-numbers-mode"><pre class="language-java"><code> <span class="token class-name">PreviewConfig</span> config <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PreviewConfig<span class="token punctuation">.</span>Builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">setLensFacing</span><span class="token punctuation">(</span>mLensFacing<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">setTargetRotation</span><span class="token punctuation">(</span>rotation<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">setTargetResolution</span><span class="token punctuation">(</span>resolution<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">setTargetAspectRatio</span><span class="token punctuation">(</span>rational<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 preview <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Preview</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">;</span>
 
<span class="token comment">//除此之外还需要设置预览视频流回调事件，和textureview绑定。</span>
<span class="token comment">//请注意textureview一定还要先移除再添加</span>
preview<span class="token punctuation">.</span><span class="token function">setOnPreviewOutputUpdateListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Preview<span class="token punctuation">.</span>OnPreviewOutputUpdateListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onUpdated</span><span class="token punctuation">(</span><span class="token class-name">Preview<span class="token punctuation">.</span>PreviewOutput</span> output<span class="token punctuation">)</span> <span class="token punctuation">{</span>
textureView <span class="token operator">=</span> mBinding<span class="token punctuation">.</span>textureView<span class="token punctuation">;</span>
<span class="token class-name">ViewGroup</span> parent <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ViewGroup</span><span class="token punctuation">)</span> textureView<span class="token punctuation">.</span><span class="token function">getParent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
parent<span class="token punctuation">.</span><span class="token function">removeView</span><span class="token punctuation">(</span>textureView<span class="token punctuation">)</span><span class="token punctuation">;</span>
parent<span class="token punctuation">.</span><span class="token function">addView</span><span class="token punctuation">(</span>textureView<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            textureView<span class="token punctuation">.</span><span class="token function">setSurfaceTexture</span><span class="token punctuation">(</span>output<span class="token punctuation">.</span><span class="token function">getSurfaceTexture</span><span class="token punctuation">(</span><span class="token punctuation">)</span>   <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><ul><li>CameraX点击拍摄照片</li></ul> <div class="language-java line-numbers-mode"><pre class="language-java"><code>imageCapture <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ImageCapture</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ImageCaptureConfig<span class="token punctuation">.</span>Builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">setTargetAspectRatio</span><span class="token punctuation">(</span>rational<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">setTargetResolution</span><span class="token punctuation">(</span>resolution<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">setLensFacing</span><span class="token punctuation">(</span>mLensFacing<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">setTargetRotation</span><span class="token punctuation">(</span>rotation<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ul><li>CameraX视频录制</li></ul> <div class="language-java line-numbers-mode"><pre class="language-java"><code>videoCapture <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VideoCapture</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">VideoCaptureConfig<span class="token punctuation">.</span>Builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">setTargetRotation</span><span class="token punctuation">(</span>rotation<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">setLensFacing</span><span class="token punctuation">(</span>mLensFacing<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">setTargetResolution</span><span class="token punctuation">(</span>resolution<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">setTargetAspectRatio</span><span class="token punctuation">(</span>rational<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">setVideoFrameRate</span><span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">setBitRate</span><span class="token punctuation">(</span><span class="token number">3</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ul><li>关联生命周期</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>CameraX.unbindAll();
CameraX.bindToLifecycle(this, preview, imageCapture, videoCapture);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="day-7"><a href="#day-7" class="header-anchor">#</a> Day 7</h2> <ul><li><p>全屏预览</p> <ul><li><p>图片的全屏预览我们使用PhotoView来实现，请注意它的scaleType需要设置成fitCenter,否则宽高可能会被裁减</p></li> <li><p>视频的全屏预览需要区分本地视频资源&amp;网络视频资源</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Uri</span> uri <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token class-name">File</span> file <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>previewUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>file<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token class-name">DataSpec</span> dataSpec <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataSpec</span><span class="token punctuation">(</span><span class="token class-name">Uri</span><span class="token punctuation">.</span><span class="token function">fromFile</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">FileDataSource</span> fileDataSource <span class="token operator">=</span> <span class="token keyword">new</span>        <span class="token class-name">FileDataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">try</span> <span class="token punctuation">{</span>fileDataSource<span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span>dataSpec<span class="token punctuation">)</span><span class="token punctuation">;</span>
    uri <span class="token operator">=</span> fileDataSource<span class="token punctuation">.</span><span class="token function">getUri</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">FileDataSource<span class="token punctuation">.</span>FileDataSourceException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
     e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
     uri <span class="token operator">=</span> <span class="token class-name">Uri</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>previewUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>

<span class="token class-name">ProgressiveMediaSource<span class="token punctuation">.</span>Factory</span> factory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ProgressiveMediaSource<span class="token punctuation">.</span>Factory</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">DefaultDataSourceFactory</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token class-name">Util</span><span class="token punctuation">.</span><span class="token function">getUserAgent</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token function">getPackageName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">ProgressiveMediaSource</span> mediaSource <span class="token operator">=</span> factory<span class="token punctuation">.</span><span class="token function">createMediaSource</span><span class="token punctuation">(</span>uri<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div></li></ul></li></ul> <h2 id="day-8"><a href="#day-8" class="header-anchor">#</a> Day 8</h2> <ul><li><p>视频无缝续播：</p> <ul><li>页面切换时首页列表不能暂停播放，否则会有画面停顿现象</li> <li>详情页需要和列表页公用player播放器，否则视频会有缓冲加载现象</li> <li>详情页需要使用新的playerView承载视频流画面，否则会有view缺失现象</li></ul></li> <li><p>列表上各组件相对位置</p> <ul><li>ViewAnchorBehavior---一个view可以把另一个view作为锚点，布局在它的下面，复写<code>onMeasureChild</code>接管子View测量,否则列表的高将不能完全正常展示，复写<code>onLayoutChild</code>接管子View的布局</li></ul></li> <li><p>视频的手势滑动特效</p> <ul><li>ViewZoomBehavior--由于playerView并不是scrollingView.所以需要在behavior中使用ViewDragHelper来协助拦截分发手势</li> <li>惯性滑动可以使用ViewCompat#postOnAnimation(Runnable run)来实现</li></ul> <h2 id="day-9"><a href="#day-9" class="header-anchor">#</a> Day 9</h2> <ul><li>1.创建任务、2.输入参数、3.创建workRequest、4.加入队列、5.监听结果</li></ul> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">//1.编写一个UploadFileWorker.class 继承自 Worker</span>
<span class="token comment">//2.创建输入参数</span>
<span class="token class-name">Data</span> inputData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Data<span class="token punctuation">.</span>Builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
     <span class="token punctuation">.</span><span class="token function">putString</span><span class="token punctuation">(</span><span class="token string">&quot;key&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;value&quot;</span><span class="token punctuation">)</span>
     <span class="token punctuation">.</span><span class="token function">putBoolean</span><span class="token punctuation">(</span><span class="token string">&quot;key1&quot;</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
     <span class="token punctuation">.</span><span class="token function">putStringArray</span><span class="token punctuation">(</span><span class="token string">&quot;key2&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
     <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//3.创建workrequest</span>
<span class="token class-name">OneTimeWorkRequest</span> request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OneTimeWorkRequest
      <span class="token punctuation">.</span>Builder</span><span class="token punctuation">(</span><span class="token class-name">UploadFileWorker</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">setInputData</span><span class="token punctuation">(</span>inputData<span class="token punctuation">)</span>
      <span class="token comment">//........其它许许多多条件约束</span>
      <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 4.加入队列</span>
<span class="token class-name">WorkContinuation</span> continuation <span class="token operator">=</span> <span class="token class-name">WorkManager</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">beginWith</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span><span class="token punctuation">.</span>enqueue<span class="token punctuation">;</span>

<span class="token comment">// 5.观察执行状态 及结果      continuation.getWorkInfosLiveData().observe(this, new Observer&lt;List&lt;WorkInfo&gt;&gt;() {</span>
   <span class="token annotation punctuation">@Override</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onChanged</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">WorkInfo</span><span class="token punctuation">&gt;</span></span> workInfos<span class="token punctuation">)</span> <span class="token punctuation">{</span>
           <span class="token comment">//监听任务执行的结果</span>
     <span class="token punctuation">}</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div></li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/kyluzoi.io/Note/Java/JavaString.html" class="prev">
        Java 字符串
      </a></span> <span class="next"><a href="/kyluzoi.io/Note/Android/test02.html">
        test02
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/kyluzoi.io/assets/js/app.8eb898c6.js" defer></script><script src="/kyluzoi.io/assets/js/2.6dcf33ab.js" defer></script><script src="/kyluzoi.io/assets/js/3.d552ed0b.js" defer></script>
  </body>
</html>
